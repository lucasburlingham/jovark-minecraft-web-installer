<?php
include("auth.php");
require('db.php');
?>
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Welcome Home</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-darkmode@0.7.0/dist/darktheme.css" />
    <script src="https://unpkg.com/bootstrap-darkmode@0.7.0/dist/theme.js"></script>


<body>
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand btn btn-outline-success hover" href="index.php"
            style="color: white !important; font-weight: normal;">
            Jovark Services
            Management Panel</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link text-success" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-success" href="">Features</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
            </ul>
            <div class="form-inline my-2 my-lg-0">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-success" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <?php
                        $username = $_SESSION['username'];
                        $query = "SELECT realname from `users` WHERE username='$username'";
                        $result = mysqli_query($con, $query) or die(mysqli_error($con));
                        $row = mysqli_fetch_assoc($result);
                        echo $row['realname'];
                        ?>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <h6 class="dropdown-header">Account</h6>
                        <a class="dropdown-item" href="profile.php">Profile</a>
                        <?php
                        $username = $_SESSION['username'];
                        $query = "SELECT theme from `users` WHERE username='$username'";
                        $result = mysqli_query($con, $query) or die(mysqli_error($con));
                        $row = mysqli_fetch_assoc($result);
                        $theme = $row['theme'];
                        if ($theme == "light") {
                            echo ('<a class="dropdown-item" href="prefs.php">Preferences</a>');
                        } else {
                        ?>
                        <a class="dropdown-item">
                            <script>
                                const themeConfig = new ThemeConfig();
                                const darkSwitch = writeDarkSwitch(themeConfig);
                                themeConfig.initTheme();
                            </script>
                        </a>
                        </head>
                        <?php } ?>



                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>


    <div class="jumbotron jumbotron-fluid">
        <h1 class="display-3">Setup</h1>
        <p class="lead">Checking Status...</p>
        <hr class="my-2">

        <?php $query = "SELECT `mc_status` from `status`";
        $result = mysqli_query($con, $query) or
            die(mysqli_error($con));
        $row = mysqli_fetch_assoc($result);
        if ($row === 'installed') {
            <div class="dark-capable jumbotron jumbotron-fluid">
                <h1 class="dark-capable display-3">Setup</h1>
                <p class="dark-capable lead">Checking Status...</p>
                <hr class="dark-capable my-2">

                <?php $query = "SELECT `mc_status` from `status`";
        $result = mysqli_query($con, $query) or
            die(mysqli_error($con));
        $row = mysqli_fetch_assoc($result);
        if ($row === 'installed') {

             ?>
    </div>
    <div class="dark-capable container-fluid">
        <div class="dark-capable row">
            <div class="dark-capable col-12 col-md-6 col-xl-4">
                <div class="dark-capable d-flex align-items-center justify-content-center h2 block">Links</div>
            </div>
            <div class="dark-capable col-12 col-xl-4">
                <div class=" d-flex align-items-center justify-content-center h2 block">System Information</div>
            </div>
            <div class="dark-capable col-12 col-md-6 col-xl-4">
                <div class="dark-capable d-flex align-items-center justify-content-center h2 block">
                    <?php
echo shell_exec("htop -n 1");
?>
                </div>
            </div>
            <div class="dark-capable col-12 col-md-6 col-xl-4">
                <div class="dark-capable d-flex align-items-center justify-content-center h2 block">Space
                    Avaliable
                </div>
            </div>
            <div class="dark-capable col-12 col-md-6 col-xl-8 order-md-2 order-2 order-sm-2">
                <div class="dark-capable d-flex align-items-center justify-content-center">
                    <div class="card text-center flex-fill">
                        <div class="card-header bg-dark dark">
                            Minecraft Console
                        </div>
                        <div class="card-body dark">
                            <iframe src="" frameborder="0"> INSERT goTTY here</iframe>
                            INSERT goTTY Here
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    </div>
    </div>

    <?php } else { ?>
    <!-- <p>Lets Start!</p>
        <p class="dark-capable lead">
            <a class="dark-capable btn btn-primary btn-lg" href="setup.php" role="button">Start Setup</a>
        </p>
    </div> -->
    <?php } ?>

    <script>
        function toggleDarkmode() {
            elements = document.getElementsByClassName("dark-capable");
            for (var i = 0; i < elements.length; i++) {
                elements[i].style.backgroundColor = "#434343";
                elements[i].style.color = "#ffffff";
            }
        }
    </script>
    ?>
    <?php } else {
        ?>
    <p>Lets Start!</p>
    <p class="lead">
        <a class="btn btn-primary btn-lg" href="setup.php" role="button">Start Setup</a>
    </p>
    <?php } ?>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
</body>

</html>